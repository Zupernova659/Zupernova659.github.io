### **UART接口介绍**

通用异步收发传输器，通常称作UART，是一种异步收发传输器，是电脑硬件的一部分。它将要传输的资料在串行通信与并行通信之间加以转换。作为把并行输入信号转成串行输出信号的芯片，UART通常被集成于其他通讯接口的连结上。

UART是一种通用串行数据总线，用于异步通信。该总线双向通信，可以实现全双工传输和接收。在嵌入式设计中，UART用于主机与辅助设备通信，如汽车音响与外接AP之间的通信，与PC机通信包括与监控调试器和其它器件，如EEPROM通信。

### **UART通信协议**

UART用一条传输线将数据一位位地顺序传送，以字符为传输单位，通信中两个字符间的时间间隔多少是不固定的， 然而在同一个字符中的两个相邻位间的时间间隔是固定的。

数据传送速率用波特率来表示， 指单位时间内载波参数变化的次数， 或每秒钟传送的二进制位数，如每秒钟传送240个字符，而每个字符包含10位（1个起始位， 1个停止位， 8个数据位），这时的波特率为2400Bd。

传输时序如下图：

![img](https://img2020.cnblogs.com/blog/1943620/202111/1943620-20211119154408032-135226384.png)

在UART中，信号线上共有两种状态， 分别用逻辑1（高电平）和逻辑0（低电平）来区分

在空闲时， 数据线应该保持在逻辑高电平状态

其中各位的意义如下：

起始位（Start Bit）：先发出一个逻辑0信号， 表示传输字符的开始

数据位（Data Bits）：可以是5~8位逻辑0或1. 如ASCII码（7位）， 扩展BCD码（8位）小端传输

校验位（Parity Bit）：数据位加上这一位后， 使得1的位数应为偶数（偶校验）或奇数（奇校验）

停止位（Stop Bit）：它是一个字符数据的结束标志。 可以是1位、1.5位、2位的高电平

空闲位：处于逻辑1状态，表示当前线路上没有资料传送

### **UART基本结构**

输出缓冲寄存器，它接收CPU从数据总线上送来的并行数据，并加以保存。

输出移位寄存器，它接收从输出缓冲器送来的并行数据，以发送时钟的速率把数据逐位移出，即将并行数据转换为串行数据输出。

输入移位寄存器，它以接收时钟的速率把出现在串行数据输入线上的数据逐位移入，当数据装满后，并行送往输入缓冲寄存器，即将串行数据转换成并行数据。

输入缓冲寄存器，它从输入移位寄存器中接收并行数据，然后由CPU取走。

控制寄存器，它接收CPU送来的控制字，由控制字的内容，决定通信时的传输方式以及数据格式等。例如采用异步方式还是同步方式，数据字符的位数，有无奇偶校验，是奇校验还是偶校验，停止位的位数等参数。

状态寄存器，状态寄存器中存放着接口的各种状态信息，例如输出缓冲区是否空，输入字符是否准备好等。在通信过程中，当符合某种状态时，接口中的状态检测逻辑将状态寄存器的相应位置“1”，以便让CPU查询。

### **UART通信速率**

数据传输可以首先从最低有效位（LSB）开始。然而，有些UART允许灵活选择先发送最低有效位或最高有效位（MSB）。微控制器中的UART传送数据的 速度范围为每秒几百位到1.5Mb。

例如，嵌入在ElanSC520微控制器中的高速UART通信的速度可以高达1.152Mbps。UART波特率还受发送和接收线对距离（线长度）的影响。

目前，市场上有只支持异步通信和同时支持异步与同步通信的两种硬件可用于UART。前者就是UART名字本身的含义，在摩托罗拉微控制器中被称为串行通信 接口（SCI）。

Microchip微控制器中的通用同步异步收发器（USART）和在富士通微控制器中的UART是后者的两个典型例子。

### **UART工作原理**

发送数据过程：空闲状态，线路处于高电位；当收到发送数据指令后，拉低线路一个数据位的时间T，接着数据按低位到高位依次发送，数据发送完毕后，接着发送奇偶校验位和停止位（停止位为高电位），一帧数据发送结束。

接收数据过程：空闲状态，线路处于高电位；当检测到线路的下降沿（线路电位由高电位变为低电位）时说明线路有数据传输，按照约定的波特率从低位到高位接收数据，数据接收完毕后，接着接收并比较奇偶校验位是否正确，如果正确则通知后续设备准备接收数据或存入缓存。

由于UART是异步传输，没有传输同步时钟。为了能保证数据传输的正确性，UART采用16倍数据波特率的时钟进行采样。每个数据有16个时钟采样，取中间的采样值，以保证采样不会滑码或误码。

一般UART一帧的数据位数为8，这样即使每个数据有一个时钟的误差，接收端也能正确地采样到数据。

UART的接收数据时序为：当检测到数据的下降沿时，表明线路上有数据进行传输，这时计数器CNT开始计数，当计数器为24=16+8时，采样的值为第0位数据。

当计数器的值为40时，采样的值为第1位数据，依此类推，进行后面6个数据的采样。如果需要进行奇偶校验，则当计数器的值为152时，采样的值即为奇偶位；当计数器的值为168时，采样的值为“1”表示停止位，一帧数据接收完成。
